# Проектная работа "Веб-ларек"

Простой интернет-магазин, демонстрирующий работу с товарами, корзиной и оформлением заказа.

---

## Используемый стек

- **HTML** — разметка страниц.
- **SCSS** — стилизация приложения.
- **TypeScript** — типизированный JavaScript для разработки.
- **Webpack** — сборка проекта.
- **MVP (Model-View-Presenter)** — архитектурный паттерн, разделяющий логику приложения на три слоя: модель, представление и посредник (реализованный через событийную модель).

---

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Инструкция по сборке и запуску

### Установка зависимостей:

```bash
npm install
```

### Запуск проекта в режиме разработки:

```bash
npm run start
```

### Сборка проекта для продакшена:

```bash
npm run build
```

---

## Архитектура проекта

Проект реализован с использованием архитектурного паттерна **MVP (Model-View-Presenter)**. Логика приложения разделена на три основных слоя:

1.  **Model** — отвечает за управление данными и бизнес-логику приложения. Включает состояние продуктов, корзины, форм заказа.
2.  **View** — отвечает за отображение данных пользователю и обработку пользовательского ввода (интерфейс).
3.  **Presenter (Посредник)** — связывает Model и View. В данном проекте роль посредника выполняет система событий (`EventEmitter`), которая позволяет компонентам реагировать на изменения данных и действия пользователя без прямого связывания.

### Основные компоненты архитектуры:

- **Данные (Model):**
  - Управляют состоянием приложения.
  - Реализованы в классах: `DataModel` (продукты), `CartModel` (корзина), `FormModel` (формы).
- **Представления (View):**
  - Отвечают за отображение данных и взаимодействие с пользователем.
  - Реализованы в классах: `ProductCard`, `ProductPreview`, `ShoppingCart`, `OrderForm`, `ContactForm`, `OrderSuccess`, `ModalWindow`.
- **События (EventEmitter):**
  - Используются для связи между компонентами через публикацию/подписку на события.
  - Обеспечивают слабую связанность и реактивное поведение приложения.

---

## Описание базовых классов

### `EventEmitter`

- **Назначение:** Обеспечивает работу событийной модели.
- **Функции:**
  - Установка (`on`, `once`) и снятие (`off`) слушателей событий.
  - Вызов (`emit`) всех слушателей при возникновении события.
  - Управление всеми активными слушателями (`onAll`, `offAll`, `trigger`).

### `ApiModel`

- **Назначение:** Взаимодействие с внешним API.
- **Функции:**
  - Получение списка продуктов с сервера (`/api/weblarek/products`).
  - Отправка данных оформленного заказа на сервер (`/api/weblarek/order`).

### `DataModel`

- **Назначение:** Управление данными о продуктах.
- **Функции:**
  - Хранение полного списка продуктов.
  - Установка текущего (активного) продукта для детального просмотра.
  - Генерация события `products:loaded` после загрузки данных.

### `CartModel`

- **Назначение:** Управление состоянием корзины покупок.
- **Функции:**
  - Добавление продукта в корзину.
  - Удаление продукта из корзины.
  - Очистка корзины.
  - Подсчет общего количества товаров и их суммарной стоимости.
  - Получение списка ID товаров в корзине.
  - Генерация события `cart:changed` при любых изменениях.

### `FormModel`

- **Назначение:** Управление состоянием и валидация данных форм заказа.
- **Функции:**
  - Хранение данных форм (адрес, контакты, способ оплаты).
  - Валидация введенных данных перед отправкой.
  - Хранение ошибок валидации (`FormValidationErrors`).
  - Генерация объекта `IOrderLot` для отправки на сервер.
  - Генерация событий `form:changed`, `formErrors:changed`, `order:ready`, `contacts:ready`.

---

## Описание компонентов представления (View)

### `ProductCard`

- **Назначение:** Отображение краткой информации о продукте на главной странице.
- **Связи:**
  - Использует данные `IProductItem` из `DataModel`.
  - Генерирует событие `product:selected` при клике на карточку.

### `ProductPreview`

- **Назначение:** Отображение подробной информации о выбранном продукте в модальном окне.
- **Связи:**
  - Использует данные активного продукта из `DataModel`.
  - Генерирует событие `product:addToCart` при нажатии кнопки "В корзину".
  - Отображает статус "уже в корзине", если товар добавлен.

### `ShoppingCart`

- **Назначение:** Отображение содержимого корзины покупок в модальном окне.
- **Связи:**
  - Использует данные из `CartModel` для отображения списка товаров и общей суммы.
  - Генерирует событие `item:remove` при удалении товара.
  - Генерирует событие `order:start` при нажатии кнопки "Оформить".

### `OrderForm`

- **Назначение:** Отображение формы выбора способа оплаты и ввода адреса доставки.
- **Связи:**
  - Использует/обновляет данные в `FormModel`.
  - Генерирует события `order:changed` (изменение полей), `order:submit` (переход к следующему шагу).
  - Отображает ошибки валидации из `FormModel`.

### `ContactForm`

- **Назначение:** Отображение формы ввода контактной информации (email, телефон).
- **Связи:**
  - Использует/обновляет данные в `FormModel`.
  - Генерирует события `contacts:changed` (изменение полей), `contacts:submit` (отправка заказа).
  - Отображает ошибки валидации из `FormModel`.

### `OrderSuccess`

- **Назначение:** Отображение сообщения об успешном оформлении заказа с указанием списанной суммы.
- **Связи:**
  - Использует данные о сумме заказа (`totalAmount`) из ответа API.
  - Генерирует событие `success:close` при закрытии окна.

### `ModalWindow`

- **Назначение:** Управление отображением модальных окон.
- **Функции:**
  - Открытие и закрытие модального окна.
  - Установка и отображение содержимого (любого `HTMLElement`).
  - Генерация события `modal:close` при закрытии.

---

## Взаимодействие компонентов (Основные сценарии)

1.  **Загрузка данных:**

    - Приложение запускается.
    - `ApiModel` запрашивает список продуктов (`/api/weblarek/products`).
    - `DataModel` сохраняет полученные данные.
    - `DataModel` генерирует событие `products:loaded`.
    - Представление (`Page`) рендерит карточки `ProductCard` на главной странице.

2.  **Выбор продукта:**

    - Пользователь кликает на `ProductCard`.
    - `ProductCard` генерирует событие `product:selected` с ID продукта.
    - `DataModel` устанавливает этот продукт как активный.
    - Открывается `ModalWindow` с компонентом `ProductPreview`, отображающим детали активного продукта.

3.  **Добавление в корзину:**

    - Пользователь нажимает кнопку "В корзину" в `ProductPreview`.
    - `ProductPreview` генерирует событие `product:addToCart`.
    - `CartModel` добавляет товар в корзину и генерирует `cart:changed`.
    - Представление обновляет иконку корзины (счетчик товаров).
    - `ProductPreview` обновляет состояние кнопки (например, "Уже в корзине").
    - Модальное окно закрывается.

4.  **Оформление заказа:**

    - Пользователь кликает на иконку корзины.
    - Открывается `ModalWindow` с компонентом `ShoppingCart`.
    - Пользователь нажимает "Оформить" в `ShoppingCart`.
    - `ShoppingCart` генерирует `order:start`.
    - Открывается `ModalWindow` с компонентом `OrderForm`.
    - Пользователь выбирает способ оплаты, вводит адрес, нажимает "Далее".
    - `OrderForm` генерирует `order:submit` (если валидация пройдена).
    - Открывается `ModalWindow` с компонентом `ContactForm`.
    - Пользователь вводит email, телефон, нажимает "Оплатить".
    - `ContactForm` генерирует `contacts:submit` (если валидация пройдена).
    - `FormModel` генерирует `order:ready`.
    - Приложение собирает данные заказа (`IOrderLot`) из `FormModel` и `CartModel`.
    - `ApiModel` отправляет заказ на сервер (`/api/weblarek/order`).

5.  **Успешное оформление:**
    - Сервер возвращает успешный ответ с суммой заказа.
    - `ApiModel` генерирует событие `order:success`.
    - `CartModel` очищает корзину (`cart:changed`).
    - Открывается `ModalWindow` с компонентом `OrderSuccess`, отображающим сумму.
    - Пользователь закрывает окно `OrderSuccess` (`success:close`).
    - Модальное окно закрывается.

---

## Типы данных

### `IProductItem`

```typescript
interface IProductItem {
	id: string;
	title: string;
	description: string;
	image: string;
	category: string;
	price: number | null;
}
```

### `IOrderLot`

```typescript
interface IOrderLot {
	paymentMethod: string;
	contactEmail: string;
	contactPhone: string;
	deliveryAddress: string;
	totalAmount: number;
	productIds: string[];
}
```

### `FormValidationErrors`

```typescript
type FormValidationErrors = Partial<Record<keyof IOrderLot, string>>;
```

---

## Реализация процессов

- **Событийная модель:** Все взаимодействия между компонентами (Model, View) построены на основе событий с использованием `EventEmitter`. Это обеспечивает слабую связанность: компоненты не знают о существовании друг друга напрямую, а только реагируют на события.
- **MVP:**
  - **Модели** (`DataModel`, `CartModel`, `FormModel`) инкапсулируют данные и логику их изменения, уведомляя систему об изменениях через события.
  - **Представления** (`ProductCard`, `ShoppingCart` и др.) отвечают за рендеринг данных, полученных из моделей (через события или прямую передачу), и генерацию событий в ответ на действия пользователя.
  - **Посредник** (реализованный через `EventEmitter` и обработчики событий в основном скрипте `index.ts`) слушает события от View, вызывает нужные методы Model для обновления данных, и слушает события от Model для обновления View.
